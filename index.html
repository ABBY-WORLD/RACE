let car; // Skapa en global variabel f√∂r bilen
const velocity = new THREE.Vector3(0, 0, 0); // Hastighetsvektor
const acceleration = 0.02; // Hur snabbt bilen accelererar
const maxSpeed = 0.5; // Maxhastighet
const friction = 0.98; // Hur mycket bilen saktar in n√§r du sl√§pper tangenterna
const rotationSpeed = 0.03; // Hur snabbt bilen sv√§nger

const keys = {}; // H√•ller koll p√• nedtryckta tangenter

// Ladda bilen fr√•n GitHub Pages och g√∂r den styrbar
console.log("üöó F√∂rs√∂ker ladda bilen...");
loader.load('https://abby-world.github.io/RACE/car_model.glb', 
    (gltf) => {
        car = gltf.scene;
        car.position.set(0, 0.5, 0);
        scene.add(car);
        console.log("‚úÖ Bil laddad!");
    },
    undefined,
    function(error) {
        console.error("üö® Bil kunde inte laddas:", error);
    }
);

// Lyssna efter tangenttryckningar
document.addEventListener("keydown", (event) => {
    keys[event.code] = true;
});
document.addEventListener("keyup", (event) => {
    keys[event.code] = false;
});

// Uppdatera bilens r√∂relse varje frame
function updateCar() {
    if (!car) return; // V√§nta tills bilen √§r laddad

    // R√∂relse fram√•t/bak√•t
    if (keys["ArrowUp"] || keys["KeyW"]) {
        velocity.z -= acceleration; // K√∂r fram√•t
    }
    if (keys["ArrowDown"] || keys["KeyS"]) {
        velocity.z += acceleration; // Backa
    }

    // Sv√§nga v√§nster/h√∂ger
    if (keys["ArrowLeft"] || keys["KeyA"]) {
        car.rotation.y += rotationSpeed; // Sv√§ng v√§nster
    }
    if (keys["ArrowRight"] || keys["KeyD"]) {
        car.rotation.y -= rotationSpeed; // Sv√§ng h√∂ger
    }

    // Begr√§nsa maxhastigheten
    velocity.z = Math.max(-maxSpeed, Math.min(maxSpeed, velocity.z));

    // Till√§mpa friktion s√• bilen inte glider f√∂r evigt
    velocity.z *= friction;

    // Uppdatera bilens position baserat p√• rotationen
    const direction = new THREE.Vector3(0, 0, -1);
    direction.applyQuaternion(car.quaternion);
    car.position.addScaledVector(direction, velocity.z);
}

// L√§gg till bilens uppdatering i animationsloopen
function animate() {
    requestAnimationFrame(animate);
    updateCar();
    controls.update();
    renderer.render(scene, camera);
}

animate();
